---
- name: Install Mysql package
  apt: 
    update_cache: yes
    name: 
      - default-mysql-server
      - default-mysql-client
      - python-mysqldb
      - python3-selinux
      - python3-semanage
      - python-setuptools 
      - python-dev
    state: present

- name: Make sure pymysql is present
  pip:
    name: pymysql
    state: present

- name: Create Mysql configuration file
  template: 
    src: my.cnf.j2 
    dest: /etc/mysql/my.cnf
  notify:
  - Restart mysql

- name: Change the authentication plugin of MySQL root user to mysql_native_password
  shell: mysql -u root -e 'UPDATE mysql.user SET plugin="mysql_native_password" WHERE user="root" AND host="localhost"'

- name: Flush Privileges
  shell: mysql -u root -e 'FLUSH PRIVILEGES'

- name: Set MySQL root password
  mysql_user:
    login_host: 'localhost'
    login_user: 'root'
    login_password: ''
    name: 'root'
    password: '{{ mysql_pass }}'
    # host: '{{ backend_host }}'
    state: present